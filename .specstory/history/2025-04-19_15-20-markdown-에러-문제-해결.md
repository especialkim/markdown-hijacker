<!-- Generated by SpecStory -->

# Markdown 에러 문제 해결 (2025-04-20 00:20:15)

_**User**_

여기 때문인지. 

/Users/yongminkim/Workspace/Temp/test3/testsub/subsub/test.md TypeError: matter is not a function
    at fsReadFrontmatter (plugin:markdown-hijacker:5766:23)
    at async test (plugin:markdown-hijacker:5845:40)

이런 에러가떠

---

_**Assistant**_



---

이 오류는 gray-matter 모듈의in 임포트 방식 때문입니다. matter가 함수로 인식되지 않고 있어요.

---

```diff
- import matter from 'gray-matter';
+ import * as matterModule from 'gray-matter';
  import * as fs from 'fs';
  
- export async function fsReadFrontmatter(filePath: string): Promise<{ frontmatter: matter.GrayMatterFile<string>, content: string }> {
+ export async function fsReadFrontmatter(filePath: string): Promise<{ frontmatter: matterModule.GrayMatterFile<string>, content: string }> {
      const content = await fsReadFile(filePath);
-     const frontmatter = matter(content);
+     const frontmatter = matterModule.default(content);
      return { frontmatter, content };
  }
  
  export async function fsUpdateFrontmatter(filePath: string, frontmatter: Record<string, any>): Promise<void> {
      const raw = await fsReadFile(filePath);
-     const { data, content } = matter(raw);
+     const { data, content } = matterModule.default(raw);
    
      const merged = { ...data, ...frontmatter };
-     const updatedContent = matter.stringify(content, merged);
+     const updatedContent = matterModule.default.stringify(content, merged);
    
      await fs.promises.writeFile(filePath, updatedContent, 'utf8');
```

---

gray-matter 모듈의 구조가 예상과 다른 것 같습니다. CommonJS 형태로 수정해보겠습니다.

---

```diff
- import * as matterModule from 'gray-matter';
+ const matter = require('gray-matter');
  import * as fs from 'fs';
  
- export async function fsReadFrontmatter(filePath: string): Promise<{ frontmatter: matterModule.GrayMatterFile<string>, content: string }> {
+ export async function fsReadFrontmatter(filePath: string): Promise<{ frontmatter: any, content: string }> {
      const content = await fsReadFile(filePath);
-     const frontmatter = matterModule.default(content);
+     const frontmatter = matter(content);
      return { frontmatter, content };
  }
  
  export async function fsUpdateFrontmatter(filePath: string, frontmatter: Record<string, any>): Promise<void> {
      const raw = await fsReadFile(filePath);
-     const { data, content } = matterModule.default(raw);
+     const { data, content } = matter(raw);
    
      const merged = { ...data, ...frontmatter };
-     const updatedContent = matterModule.default.stringify(content, merged);
+     const updatedContent = matter.stringify(content, merged);
    
      await fs.promises.writeFile(filePath, updatedContent, 'utf8');
```

---

이제 TypeScript 오류는 없어졌지만, Obsidian 플러그인에서는 CommonJS `require`가 제대로 작동하지 않을 수 있습니다. 다른 접근법으로 시도해보겠습니다.

---

```diff
- const matter = require('gray-matter');
+ import * as matterModule from 'gray-matter';
  import * as fs from 'fs';
+ 
+ // matter 함수에 접근하기 위한 헬퍼
+ const matter = function(input: any, options?: any) {
+     return (matterModule as any).default(input, options);
+ };
+ // stringify 메소드도 접근 가능하도록 설정
+ matter.stringify = function(content: string, data: any, options?: any) {
+     return (matterModule as any).default.stringify(content, data, options);
+ };
  
  export async function fsReadFrontmatter(filePath: string): Promise<{ frontmatter: any, content: string }> {
```

---

좀 더 직접적인 접근 방식으로 시도해보겠습니다.

---

```bash
cd /Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker && npm list gray-matter
```

```
markdown-hijacker@0.1.0 /Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/
plugins/markdown-hijacker
└── gray-matter@4.0.3


```

---

```bash
cd /Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker && cat tsconfig.json | grep allowSyntheticDefaultImports
```

```
yongminkim@Yongminui-Mac-Studio markdown-hijacker % 

```

---

```bash
cd /Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker && cat tsconfig.json
```

```
yongminkim@Yongminui-Mac-Studio markdown-hijacker % cd /Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidi
an/plugins/markdown-hijacker && cat tsconfig.json   cd /Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidi
an/plugins/markdown-hijacker && cat tsconfig.json
{
  "compilerOptions": {
    "baseUrl": ".",
    "inlineSourceMap": true,
    "inlineSources": true,
    "module": "ESNext",
    "target": "ES6",
    "allowJs": true,
    "noImplicitAny": true,
    "moduleResolution": "node",
    "importHelpers": true,
    "isolatedModules": true,
    "strictNullChecks": true,
    "lib": [
      "DOM",
      "ES5",
      "ES6",
      "ES7"
    ]
  },
  "include": [
    "**/*.ts"
  ]
}
yongminkim@Yongminui-Mac-Studio markdown-hijacker %
```

---

```diff
      "isolatedModules": true,
      "strictNullChecks": true,
+     "allowSyntheticDefaultImports": true,
      "lib": [
        "DOM",
```

---

```diff
- import * as matterModule from 'gray-matter';
+ import matter from 'gray-matter';
  import * as fs from 'fs';
  
  // matter 함수에 접근하기 위한 헬퍼
- const matter = function(input: any, options?: any) {
+ const matterHelper = function(input: any, options?: any) {
      return (matterModule as any).default(input, options);
  };
  // stringify 메소드도 접근 가능하도록 설정
- matter.stringify = function(content: string, data: any, options?: any) {
+ matterHelper.stringify = function(content: string, data: any, options?: any) {
      return (matterModule as any).default.stringify(content, data, options);
  };
  
  export async function fsReadFrontmatter(filePath: string): Promise<{ frontmatter: any, content: string }> {
      const content = await fsReadFile(filePath);
-     const frontmatter = matter(content);
+     const frontmatter = matterHelper(content);
      return { frontmatter, content };
  }
  
  export async function fsUpdateFrontmatter(filePath: string, frontmatter: Record<string, any>): Promise<void> {
      const raw = await fsReadFile(filePath);
-     const { data, content } = matter(raw);
+     const { data, content } = matterHelper(raw);
    
      const merged = { ...data, ...frontmatter };
-     const updatedContent = matter.stringify(content, merged);
+     const updatedContent = matterHelper.stringify(content, merged);
    
      await fs.promises.writeFile(filePath, updatedContent, 'utf8');
```

---

```diff
  import matter from 'gray-matter';
  import * as fs from 'fs';
- 
- // matter 함수에 접근하기 위한 헬퍼
- const matterHelper = function(input: any, options?: any) {
-     return (matterModule as any).default(input, options);
- };
- // stringify 메소드도 접근 가능하도록 설정
- matterHelper.stringify = function(content: string, data: any, options?: any) {
-     return (matterModule as any).default.stringify(content, data, options);
- };
  
  export async function fsReadFrontmatter(filePath: string): Promise<{ frontmatter: any, content: string }> {
      const content = await fsReadFile(filePath);
-     const frontmatter = matterHelper(content);
+     const frontmatter = matter(content);
      return { frontmatter, content };
  }
  
  export async function fsUpdateFrontmatter(filePath: string, frontmatter: Record<string, any>): Promise<void> {
      const raw = await fsReadFile(filePath);
-     const { data, content } = matterHelper(raw);
+     const { data, content } = matter(raw);
    
      const merged = { ...data, ...frontmatter };
-     const updatedContent = matterHelper.stringify(content, merged);
+     const updatedContent = matter.stringify(content, merged);
    
      await fs.promises.writeFile(filePath, updatedContent, 'utf8');
```

---

이제 수정이 완료되었습니다. 문제해결 과정을 요약하면:

1. 원래 코드에서는 gray-matter 모듈을 default 임포트로 사용했지만, TypeScript 설정에서 `allowSyntheticDefaultImports` 옵션이 없어서 오류가 발생했습니다.

2. 해결책:
   - `tsconfig.json` 파일에 `"allowSyntheticDefaultImports": true` 옵션을 추가했습니다.
   - utils.ts 파일에서 기존의 `import matter from 'gray-matter'` 방식을 유지할 수 있게 되었습니다.

이제 gray-matter 모듈을 올바르게 임포트하고 사용할 수 있으므로 "matter is not a function" 오류가 해결될 것입니다. 플러그인을 다시 로드하거나 Obsidian을 재시작하면 변경사항이 적용됩니다.

---

_**User**_

이거 에러나느데 어떻게 하지? 

---

_**Assistant**_



---

fsReadFrontmatter 함수의 리턴 타입과 반환값이 변경되었네요. 함수를 호출하는 쪽에서 이전 형식(`{ frontmatter, content }`)을 기대하고 있어 에러가 발생합니다.

---

<details>
            <summary>Grep search for "fsReadFrontmatter" • **3** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker/reSrc/watchers/ExternalWatcher.ts` | L4 | `import { fsReadFrontmatter } from "reSrc/sync/utils";` |
| `file:///Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker/reSrc/watchers/ExternalWatcher.ts` | L93 | `const frontmatter = await fsReadFrontmatter(path);` |
| `file:///Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker/reSrc/sync/utils.ts` | L3 | `export async function fsReadFrontmatter(filePath: string): Promise<matter.GrayMatterFile<string>> {` |
| `file:///Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker/reSrc/watchers/ExternalWatcher.ts` | L4 | `import { fsReadFrontmatter } from "reSrc/sync/utils";` |
| `file:///Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker/reSrc/watchers/ExternalWatcher.ts` | L93 | `const frontmatter = await fsReadFrontmatter(path);` |

</details>

---

Read file: reSrc/watchers/ExternalWatcher.ts

---

<details>
            <summary>Grep search for "fsReadFrontmatter\(.*\)" • **3** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker/reSrc/sync/utils.ts` | L3 | `export async function fsReadFrontmatter(filePath: string): Promise<matter.GrayMatterFile<string>> {` |
| `file:///Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker/reSrc/watchers/ExternalWatcher.ts` | L93 | `const frontmatter = await fsReadFrontmatter(path);` |
| `file:///Users/yongminkim/Workspace/Obsidian/Yongmini/.obsidian/plugins/markdown-hijacker/reSrc/watchers/ExternalWatcher.ts` | L93 | `const frontmatter = await fsReadFrontmatter(path);` |

</details>

---

<details>
            <summary>Searched codebase "using fsReadFrontmatter and expecting content" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `reSrc/sync/utils.ts` | L1-8 |
| `reSrc/sync/utils.ts` | L8-18 |
| `src/utils/frontmatter-utils.ts` | L78-94 |
| `src/utils/frontmatter-utils.ts` | L94-119 |
| `src/utils/frontmatter-utils.ts` | L13-60 |
| `src/utils/frontmatter-utils.ts` | L119-152 |
| `src/utils/frontmatter-utils.ts` | L255-299 |
| `src/utils/frontmatter-utils.ts` | L152-185 |
| `src/utils/frontmatter-utils.ts` | L60-78 |
| `src/utils/frontmatter-utils.ts` | L218-255 |
| `src/utils/frontmatter-utils.ts` | L185-218 |
| `src/sync/sync-manager.ts` | L94-127 |
| `src/utils/frontmatter-utils.ts` | L1-13 |
| `src/utils/frontmatter-utils.ts` | L309-359 |
| `src/utils/manual-frontmatter.js` | L1-52 |
| `src/sync/external-sync.ts` | L291-327 |
| `src/utils/manual-frontmatter.js` | L52-89 |
| `src/watchers/external-watcher.ts` | L341-370 |
| `src/sync/external-sync.ts` | L578-627 |
| `src/sync/sync-manager.ts` | L72-94 |
| `reSrc/frontmatter/FrontmatterManager.ts` | L5-16 |
| `src/sync/external-sync.ts` | L1-22 |
| `src/utils/frontmatter-utils.ts` | L299-309 |
| `src/sync/internal-sync.ts` | L310-340 |
| `src/watchers/external-watcher.ts` | L647-679 |

</details>

---

_**User**_

아니 머해. 여기 말이야

---

_**Assistant**_



---

Read file: reSrc/watchers/ExternalWatcher.ts

---

테스트 함수에서 발생한 문제입니다. fsReadFrontmatter의 반환값이 변경되었지만, test 함수는 여전히 이전 형식을 기대하고 있어요.

---



---

_**User**_

For the code present, we get this error:
```
Property 'getBasePath' does not exist on type 'DataAdapter'.
```
How can I resolve this? If you propose a fix, please make it concise.

---

_**Assistant**_



---

```diff
              this.snapShot[this.connection.id] = snapshotList;
  
-             const basePath = this.app.vault.adapter.getBasePath();
+             const basePath = this.app.vault.adapter.basePath;
              const snapshotPath = pathModule.join(basePath, ".obsidian", "plugins", "markdown-hijacker", "data", `${this.connection.id}.json`);
  
```

---

Let's check the available methods in Obsidian's API:

---

```diff
              this.snapShot[this.connection.id] = snapshotList;
  
-             const basePath = this.app.vault.adapter.basePath;
-             const snapshotPath = pathModule.join(basePath, ".obsidian", "plugins", "markdown-hijacker", "data", `${this.connection.id}.json`);
+             const configDir = this.app.vault.configDir;
+             const snapshotPath = pathModule.join(configDir, "plugins", "markdown-hijacker", "data", `${this.connection.id}.json`);
  
              try {
```

---

_**User**_

plugin:markdown-hijacker:5804 [SyncManager] Snapshot 저장 실패 Error: ENOENT: no such file or directory, mkdir '.obsidian/plugins/markdown-hijacker/data'
    at Object.mkdirSync (node:fs:1371:26)
    at SyncManager.handleExternalEvent (plugin:markdown-hijacker:5800:13)
    at FSWatcher.eval (plugin:markdown-hijacker:5862:21)
    at FSWatcher.emit (node:events:519:28)
    at eval (plugin:markdown-hijacker:5256:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)

---

_**Assistant**_



---

```diff
  
              const configDir = this.app.vault.configDir;
-             const snapshotPath = pathModule.join(configDir, "plugins", "markdown-hijacker", "data", `${this.connection.id}.json`);
+             const snapshotPath = pathModule.resolve(configDir, "plugins", "markdown-hijacker", "data", `${this.connection.id}.json`);
  
              try {
```

---

_**User**_

[SyncManager] 외부 파일 변화 감지: ready, /Users/yongminkim/Workspace/Temp/test2,/Users/yongminkim/Workspace/Temp/test2/545.md,/Users/yongminkim/Workspace/Temp/test2/cat.md,/Users/yongminkim/Workspace/Temp/test2/cur.md,/Users/yongminkim/Workspace/Temp/test2/dfdf.md,/Users/yongminkim/Workspace/Temp/test2/dog.md,/Users/yongminkim/Workspace/Temp/test2/hello.md,/Users/yongminkim/Workspace/Temp/test2/hirit.md,/Users/yongminkim/Workspace/Temp/test2/newFile.md,/Users/yongminkim/Workspace/Temp/test2/test.md,/Users/yongminkim/Workspace/Temp/test2/world.md
plugin:markdown-hijacker:5804 [SyncManager] Snapshot 저장 실패 Error: ENOENT: no such file or directory, mkdir '/.obsidian/plugins/markdown-hijacker/data'
    at Object.mkdirSync (node:fs:1371:26)
    at SyncManager.handleExternalEvent (plugin:markdown-hijacker:5800:13)
    at FSWatcher.eval (plugin:markdown-hijacker:5862:21)
    at FSWatcher.emit (node:events:519:28)
    at eval (plugin:markdown-hijacker:5256:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
handleExternalEvent @ plugin:markdown-hijacker:5804
eval @ plugin:markdown-hijacker:5862
emit @ node:events:519
eval @ plugin:markdown-hijacker:5256
processTicksAndRejections @ node:internal/process/task_queues:77
plugin:markdown-hijacker:5780 [SyncManager] 외부 파일 변화 감지: ready, /Users/yongminkim/Workspace/Temp/test3,/Users/yongminkim/Workspace/Temp/test3/test.md
plugin:markdown-hijacker:5804 [SyncManager] Snapshot 저장 실패 Error: ENOENT: no such file or directory, mkdir '/.obsidian/plugins/markdown-hijacker/data'
    at Object.mkdirSync (node:fs:1371:26)
    at SyncManager.handleExternalEvent (plugin:markdown-hijacker:5800:13)
    at FSWatcher.eval (plugin:markdown-hijacker:5862:21)
    at FSWatcher.emit (node:events:519:28)
    at eval (plugin:markdown-hijacker:5256:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
handleExternalEvent @ plugin:markdown-hijacker:5804
eval @ plugin:markdown-hijacker:5862
emit @ node:events:519
eval @ plugin:markdown-hijacker:5256
processTicksAndRejections @ node:internal/process/task_queues:77
plugin:hot-reload:115 enabled markdown-hijacker

---

_**Assistant**_



---

문제는 configDir이 절대 경로를 반환하지 않아서 발생합니다. 파일 시스템 루트에 디렉토리를 만들려고 시도하고 있습니다.

---

```diff
              this.snapShot[this.connection.id] = snapshotList;
  
-             const configDir = this.app.vault.configDir;
-             const snapshotPath = pathModule.resolve(configDir, "plugins", "markdown-hijacker", "data", `${this.connection.id}.json`);
+             try {
+                 // Get the path to the .obsidian/plugins folder
+                 const basePath = (this.app.vault.adapter as any).getBasePath?.() || '';
+                 const pluginDataPath = pathModule.join(basePath, '.obsidian', 'plugins', 'markdown-hijacker', 'data');
+                 const snapshotPath = pathModule.join(pluginDataPath, `${this.connection.id}.json`);
                  
-             try {
-                 fs.mkdirSync(pathModule.dirname(snapshotPath), { recursive: true });
+                 fs.mkdirSync(pluginDataPath, { recursive: true });
                  fs.writeFileSync(snapshotPath, JSON.stringify(snapshotList, null, 2), "utf-8");
                  console.log(`[SyncManager] Snapshot 저장 완료: ${snapshotPath}`);
```

---

