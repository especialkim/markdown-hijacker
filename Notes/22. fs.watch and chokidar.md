`node.js` 에서 폴더를 감기하기 위해 `fs.watch`와 `chokidar`를 사용할 수 있음

- fs.watch: Node.js에 내장된 기본적인 파일 시스템 감지 기능입니다.
- chokidar: fs.watch를 포함한 다양한 하위 기능을 사용하여 더 안정적이고 일관적인 파일 시스템 감지를 제공하는 외부 라이브러리입니다.

대부분의 실제 애플리케이션, 특히 파일 시스템 변화에 민감하게 반응해야 하는 빌드 도구, 동기화 프로그램, 개발 서버 등에서는 chokidar의 안정성과 일관성 때문에 fs.watch보다 훨씬 선호됩니다. fs.watch의 불안정한 이벤트를 직접 처리하려면 복잡한 예외 처리 로직(파일 존재 확인, 파일/폴더 타입 확인, 이벤트 디바운싱 등)을 직접 구현해야 하는데, chokidar는 이러한 번거로움을 대부분 해결해 줍니다.

## 효율적으로 동기화 하기 위한 워크플로우

- chokidar는 이벤트 기반 감시이므로 Node 서버가 꺼진 동안의 변경사항은 알 수 없음

- 감시 시작 전: chokidar가 초기 감시 대상(snapshot)을 메모리에 로드
    - chokidar.getWatched()로 현재 감시 중인 경로 확인 가능
    - 필요한 경우 이 목록을 기반으로 수동 재귀 stat 최소화

- 시스템 재시작 시
    - 이전에 chokidar로 감시했던 파일 목록(snapshot.json 등)을 기반으로
    - 해당 파일들을 fs.readFileSync()로 직접 읽어 현재 내용과 비교
    - 내용이 다를 경우 fs.statSync()로 수정 시간을 확인하여
        - 어느 쪽이 최신 파일인지 판단
        - 최신 파일 기준으로 덮어쓰거나 병합

- 신규 파일 감지는 chokidar가 실시간으로 감지
    - ignore 조건 외 경로에서 add 이벤트 발생

- 이벤트 발생 시
    - 변경된 경로의 snapshot 정보를 메모리에 즉시 반영
    - 디스크에 저장은 디바운스 방식으로 처리 (예: 2초간 추가 이벤트 없을 때 저장)
    - setTimeout으로 flush를 지연시켜 중복 저장 방지 및 안정성 확보

- 모든 비교 완료 후 chokidar로 실시간 감시 전환
    - 변경사항 발생 시 핸들러를 통해 동기화 수행

- chokidar가 감시하는 대상은 메모리에만 유지되므로
    - 시스템 종료 전 snapshot.json 형태로 저장해두어야 함
    - 저장 정보: 경로, mtimeMs, size 또는 hash 등