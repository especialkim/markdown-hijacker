# 프로젝트 설정 및 기본 구조 구축

## 필요한 설정 메뉴 구조

### 1. 설정 인터페이스 정의

```typescript
// 폴더 매핑 인터페이스
interface FolderMapping {
    id: string;            // 고유 ID (UUID)
    vaultPath: string;     // Vault 내 상대 경로
    externalPath: string;  // 외부 폴더 절대 경로
    enabled: boolean;      // 활성화 여부
}

// 플러그인 설정 인터페이스
interface MarkdownHijackerSettings {
    pluginEnabled: boolean;         // 플러그인 전체 활성화 여부
    folderMappings: FolderMapping[];// 폴더 매핑 목록
    
    excludeFoldersEnabled: boolean; // 제외할 서브폴더 옵션 활성화 여부
    excludeFolders: string;         // 제외할 서브폴더 목록 (콤마 구분)
    
    includeFoldersEnabled: boolean; // 포함할 서브폴더 옵션 활성화 여부
    includeFolders: string;         // 포함할 서브폴더 목록 (콤마 구분)
    
    syncInterval: number;           // 동기화 확인 간격 (밀리초)
    debugMode: boolean;             // 디버그 모드 활성화 여부
}
```

### 2. 기본 설정값 정의

```typescript
const DEFAULT_SETTINGS: MarkdownHijackerSettings = {
    pluginEnabled: false,
    folderMappings: [],
    excludeFoldersEnabled: false,
    excludeFolders: "",
    includeFoldersEnabled: false,
    includeFolders: "",
    syncInterval: 1000,    // 1초
    debugMode: false
}
```

### 3. 설정 UI 화면 구조

1. **플러그인 활성화 섹션**
   - 플러그인 전체 활성화/비활성화 토글 스위치
   - 현재 상태 표시 (활성화/비활성화)

2. **폴더 매핑 섹션**
   - 매핑 목록 표시 (테이블 형태)
     - Vault 상대 경로 | 외부 폴더 절대 경로 | 활성화 여부 | 삭제 버튼
   - 매핑 추가 버튼
     - 클릭 시 다이얼로그 표시:
       - Vault 경로 선택 필드 (파일 브라우저 버튼 제공)
       - 외부 경로 선택 필드 (OS 파일 다이얼로그 버튼 제공)
       - 추가/취소 버튼

3. **서브폴더 필터링 섹션**
   - 제외할 서브폴더 설정
     - 활성화/비활성화 토글 스위치
     - TextArea (콤마로 구분된 폴더명 입력)
     - 설명 텍스트 (사용 방법)
   - 포함할 서브폴더 설정
     - 활성화/비활성화 토글 스위치
     - TextArea (콤마로 구분된 폴더명 입력)
     - 설명 텍스트 (사용 방법)
   - 주의사항 표시: 두 옵션은 동시에 활성화할 수 없음

4. **고급 설정 섹션**
   - 동기화 간격 설정 (슬라이더 또는 숫자 입력)
   - 디버그 모드 활성화 토글 스위치

5. **설정 저장/리셋 버튼**
   - 변경사항 저장 버튼
   - 기본값으로 리셋 버튼

### 4. 설정 UI 구현 계획

1. **설정 탭 클래스 구조**
```typescript
class MarkdownHijackerSettingTab extends PluginSettingTab {
    plugin: MarkdownHijacker;

    constructor(app: App, plugin: MarkdownHijacker) {
        super(app, plugin);
        this.plugin = plugin;
    }

    display(): void {
        // UI 요소 구현
        this.containerEl.empty();
        
        this.addPluginEnableToggle();
        this.addFolderMappingSection();
        this.addSubfolderFilterSection();
        this.addAdvancedSettingsSection();
    }

    // 각 섹션 구현 메서드
    private addPluginEnableToggle(): void { /* ... */ }
    private addFolderMappingSection(): void { /* ... */ }
    private addSubfolderFilterSection(): void { /* ... */ }
    private addAdvancedSettingsSection(): void { /* ... */ }
}
```

2. **폴더 매핑 추가/삭제 로직**
   - UUID 생성 유틸리티
   - 폴더 경로 검증 유틸리티
   - Vault 내 경로 선택 도우미
   - 외부 경로 선택 다이얼로그 연동

3. **설정 저장/불러오기 로직**
   - Obsidian Data API 활용
   - 설정 변경 감지 및 자동 저장
   - 설정 마이그레이션 (버전 업그레이드 시)

### 5. 플러그인 주요 클래스 구조

```typescript
export default class MarkdownHijacker extends Plugin {
    settings: MarkdownHijackerSettings;
    
    // 파일 모니터링 관련 객체들
    fileWatchers: Map<string, FSWatcher>;
    vaultEventRefs: EventRef[];
    
    // 동기화 관리
    syncInProgress: boolean;
    lastSyncTime: number;
    
    async onload() {
        await this.loadSettings();
        this.addSettingTab(new MarkdownHijackerSettingTab(this.app, this));
        
        // 이벤트 리스너, 명령 등록
        this.registerCommands();
        this.setupStatusBar();
        
        // 플러그인이 활성화된 경우에만 모니터링 시작
        if (this.settings.pluginEnabled) {
            this.startMonitoring();
        }
    }
    
    onunload() {
        this.stopMonitoring();
    }
    
    async loadSettings() {
        this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
    }
    
    async saveSettings() {
        await this.saveData(this.settings);
    }
    
    startMonitoring() { /* ... */ }
    stopMonitoring() { /* ... */ }
    // 기타 메서드
}
```

## 개발 순서

1. 기본 클래스 및 인터페이스 구현
2. 설정 저장/로드 구현
3. 기본 설정 UI 골격 구현
4. 폴더 매핑 추가/삭제 UI 및 로직 구현
5. 서브폴더 필터링 옵션 UI 구현
6. 고급 설정 섹션 UI 구현
7. 상태바 및 리본 아이콘 추가
8. 플러그인 활성화/비활성화 토글 기능 구현
